<!DOCTYPE html>
<html style="height: 100%">
    <head>
        <meta charset="utf-8">

<!-- Beginning Include Libraries -->

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<script src="/lib/scripts/utils.js"></script>
<script src="/lib/scripts/env.js"></script>
<script src="/lib/scripts/jquery.min.js"></script>
<link href="/lib/styles/css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/lib/styles/style.css">
<script src="https://unpkg.com/mustache@latest"></script>

<!-- End Include Libraries -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

    </head>
    <body style="height: 100%; margin: 0">
        <div id="container" style="height: 100%"></div>
    </body>


<!-- Beginning Include Data Request -->
 <script>


//environment_widget = "https://api-dev.askdata.com";
//environment_widget = "https://api.askdata.com"  // prod  da togliere quando porto su...

// Request charting data
$.ajax({

       url: environment_widget +"/smartinsight/widgets/" + getUrlParameter('widgetId'),
       type: "GET",
       async: false,
       beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + getToken() 
        ).setRequestHeader('Content-Type','application/json')},
       success: function(data) { 

            console.log(data)

          

            var dom = document.getElementById("container");
var myChart = echarts.init(dom);
var app = {};

var option;


try{
        var col1 = data.fields.s3_id.data
        var col2 = data.fields.s4_id.data
        } 
catch (error) {
        console.error(error);
        // expected output: ReferenceError: nonExistentFunction is not defined
        // Note - error messages will vary depending on browser
        var col1 = "#02a1db"
        var col2 = "#011EA0"
        }

 
 var label1 = data.fields.s1_id.data
 var label2 = data.fields.s2_id.data
 var data1 = data.fields.m1_id.data
 var data2 = data.fields.m2_id.data
 var names = data.fields.m3_id.data
 
 var dimension = [];
$.each(names, function(i, el){
    if($.inArray(el, dimension) === -1) dimension.push(el);
});
 option = { 
                legend: {
                    data: 0, 
                    bottom: 10
                },
                xAxis: {
                    type: 'category',
                    data: dimension,
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    name: label1,
                    data: data1,
                    type: 'line',
                    showSymbol: false,
                    smooth: false,
                        lineStyle: {
                        color: col1,
                        width: 2.5
                    },
                    itemStyle: {
                        borderWidth: 2.5,
                        color: col1
                    }
                },{
                    name: label2,
                    data: data2,
                    type: 'line',
                    showSymbol: false,
                    smooth: false,
                        lineStyle: {
                        color: col2,
                        width: 2.5
                    },
                    itemStyle: {
                        borderWidth: 2.5,
                        color: col2
                    }
                }]
            };

if (option && typeof option === 'object') {
    myChart.setOption(option);
}




        }
  });

/*
// Redirect to login if not authenticated 
$(document).ajaxError(function( event, jqxhr, settings, exception ) {
    if ( jqxhr.status== 401 ) {
      location.replace(environment_auth+"/login");

    }
});
*/

</script>
<!-- End Include Data Request -->

</html>
    