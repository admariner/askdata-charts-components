<html>
<HEAD>

<!-- Beginning Include Header -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<script src="/lib/scripts/utils.js"></script>
<script src="/lib/scripts/env.js"></script>
<script src="/lib/scripts/jquery.min.js"></script>
<link href="/lib/styles/css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/lib/styles/style.css">
<script src="https://unpkg.com/mustache@latest"></script>

<script type="text/javascript">
var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};
</script>

  <script>

// Retrieve auth token for URL of from the Cookies
if (getUrlParameter('token') != undefined){
  var token = getUrlParameter('token');
}else{
  var token = Cookies.get('access_token')
}

</script>

<!-- End Include Header -->

  <link rel="preconnect" href="https://fonts.gstatic.com"> <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

</head>

<body>

<div id="target" style="margin-top: 7%;">Failed Loading widget. Check your inputs.</div>

  <script id="template" type="x-tmpl-mustache">
  
  <svg width="100%" viewBox="0 0 1194 320" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect x="7.5" y="7.5" width="1179" height="305" rx="22.5" fill="#E9F2FF" stroke="#F2994A" stroke-width="5"/>
  <g filter="url(#filter0_d)">
  <rect x="53" y="80" width="346" height="153" rx="16" fill="white" />
  <rect x="53.5" y="80.5" width="345" height="152" rx="15.5" />
  </g>
  <g filter="url(#filter1_d)">
  <rect x="429" y="80" width="346" height="153" rx="16" fill="white"/>
  <rect x="429.5" y="80.5" width="345" height="152" rx="15.5" stroke="url(#paint1_linear)"/>
  </g>
  <g filter="url(#filter2_d)">
  <rect x="805" y="80" width="346" height="153" rx="16" fill="white"/>
  <rect x="805.5" y="80.5" width="345" height="152" rx="15.5" stroke="url(#paint2_linear)"/>
  </g>
  <text fill="#219653" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="50" font-weight="bold" letter-spacing="0em"><tspan text-anchor="middle" x="226" y="162.172">{{fields.m1_id.0.data.0}}</tspan></text>
  <text fill="#EB5757" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="64" font-weight="bold" letter-spacing="0em"><tspan text-anchor="middle" x="606" y="162.172">{{fields.m1_id.1.data.0}}</tspan></text>
  <text fill="#282C32" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="50" font-weight="bold" letter-spacing="0em"><tspan text-anchor="middle" x="978" y="162.172">{{fields.m1_id.2.data.0}}</tspan></text>
  <text fill="#4E5461" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="23" letter-spacing="0em"><tspan x="830.166" y="265.361">More Info https://askdata.com</tspan></text>
  <text fill="#929BA7" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="24" font-weight="bold" letter-spacing="0em"><tspan text-anchor="middle" x="226" y="211">{{fields.m1_id.0.name}}</tspan></text>
  <text fill="#929BA7" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="24" font-weight="bold" letter-spacing="0em"><tspan text-anchor="middle" x="606" y="211">{{fields.m1_id.1.name}}</tspan></text>
  <text fill="#929BA7" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="24" font-weight="bold" letter-spacing="0em"><tspan text-anchor="middle" x="978" y="211">{{fields.m1_id.2.name}}</tspan></text>
  <text fill="black" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="24" font-style="italic" font-weight="300" letter-spacing="0em"><tspan x="53" y="62.2031"></tspan></text>
  <rect x="7.5" y="7.5" width="1179" height="305" rx="22.5" stroke="white" stroke-width="15"/>
  <defs>
  <filter id="filter0_d" x="41" y="72" width="370" height="177" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
  <feFlood flood-opacity="0" result="BackgroundImageFix"/>
  <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
  <feOffset dy="4"/>
  <feGaussianBlur stdDeviation="6"/>
  <feColorMatrix type="matrix" values="0 0 0 0 0.635069 0 0 0 0 0.776394 0 0 0 0 0.983333 0 0 0 0.3 0"/>
  <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
  <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
  </filter>
  <filter id="filter1_d" x="417" y="72" width="370" height="177" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
  <feFlood flood-opacity="0" result="BackgroundImageFix"/>
  <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
  <feOffset dy="4"/>
  <feGaussianBlur stdDeviation="6"/>
  <feColorMatrix type="matrix" values="0 0 0 0 0.635069 0 0 0 0 0.776394 0 0 0 0 0.983333 0 0 0 0.3 0"/>
  <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
  <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
  </filter>
  <filter id="filter2_d" x="793" y="72" width="370" height="177" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
  <feFlood flood-opacity="0" result="BackgroundImageFix"/>
  <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
  <feOffset dy="4"/>
  <feGaussianBlur stdDeviation="6"/>
  <feColorMatrix type="matrix" values="0 0 0 0 0.635069 0 0 0 0 0.776394 0 0 0 0 0.983333 0 0 0 0.3 0"/>
  <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
  <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
  </filter>
  <linearGradient id="paint0_linear" x1="226" y1="80" x2="226" y2="233" gradientUnits="userSpaceOnUse">
  <stop stop-color="#E9F2FF" stop-opacity="0"/>
  <stop offset="1" stop-color="#E9F2FF"/>
  </linearGradient>
  <linearGradient id="paint1_linear" x1="602" y1="80" x2="602" y2="233" gradientUnits="userSpaceOnUse">
  <stop stop-color="#E9F2FF" stop-opacity="0"/>
  <stop offset="1" stop-color="#E9F2FF"/>
  </linearGradient>
  <linearGradient id="paint2_linear" x1="978" y1="80" x2="978" y2="233" gradientUnits="userSpaceOnUse">
  <stop stop-color="#E9F2FF" stop-opacity="0"/>
  <stop offset="1" stop-color="#E9F2FF"/>
  </linearGradient>
  </defs>
  </svg>
    </script>

    <script>
// Request charting data
$.ajax({
       url: environment_widget +"/smartinsight/widgets/" + getUrlParameter('widgetId'),
       type: "GET",
       async: false,
       beforeSend: (xhr) => setAuthHeader(xhr),
       success: function(data) { 
        console.log(data)
        var template = document.getElementById('template').innerHTML;
        var rendered = Mustache.render(template, data);
        document.getElementById('target').innerHTML = rendered;
        console.log(rendered)
  }
  }); 

/*
// Redirect to login if not authenticated 
$(document).ajaxError(function( event, jqxhr, settings, exception ) {
    if ( jqxhr.status== 401 ) {
      location.replace(environment_auth+"/login");

    }
});
*/
  </script>
</body>

