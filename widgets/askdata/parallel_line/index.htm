<!DOCTYPE html>
<html style="height: 100%">
<!-- Start Custom  Style -->

<!-- End Custom style -->

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script
        src='//production-assets.codepen.io/assets/editor/live/console_runner-079c09a0e3b9ff743e39ee2d5637b9216b3545af0de366d4b9aad9dc87e26bfd.js'></script>
    <script
        src='//production-assets.codepen.io/assets/editor/live/events_runner-73716630c22bbc8cff4bd0f07b135f00a0bdc5d14629260c3ec49e5606f98fdd.js'></script>
    <script
        src='//production-assets.codepen.io/assets/editor/live/css_live_reload_init-2c0dc5167d60a5af3ee189d570b1835129687ea2a61bee3513dee3a50c115a77.js'></script>
    <meta charset='UTF-8'>
    <meta name="robots" content="noindex">
    <link rel="shortcut icon" type="image/x-icon"
        href="//production-assets.codepen.io/assets/favicon/favicon-8ea04875e70c4b0bb41da869e81236e54394d63638a1ef12fa558a4a835f1164.ico" />
    <link rel="mask-icon" type=""
        href="//production-assets.codepen.io/assets/favicon/logo-pin-f2d2b6d2c61838f7e76325261b7195c27224080bc099486ddd6dccb469b8e8e6.svg"
        color="#111" />
    <link rel="canonical" href="https://codepen.io/supah/pen/WwrJpw?limit=all&page=86&q=box" />
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css'>
    <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Open+Sans'>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <script src="/lib/scripts/utils.js"></script>
    <script src="/lib/scripts/env.js"></script>
    <script src='https://code.jquery.com/jquery-3.2.1.slim.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js'></script>
    <script src="/lib/scripts/jquery.min.js"></script>
    <link href="/lib/styles/css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="/lib/styles/style.css">
    <script src="https://unpkg.com/mustache@latest"></script>
</head>

</head>
<!-- Start body -->

<body style="height: 100%; margin: 0">
    <div id="container" style="height: 100%"></div>
</body>

<!-- End body -->

<!-- Start Ajax -->
<script type="text/javascript">


    //environment_widget = "https://api-dev.askdata.com";
    //environment_widget = "https://api.askdata.com"  // prod  da togliere quando porto su...


    $.ajax({

        url: environment_widget + "/smartinsight/widgets/" + getUrlParameter('widgetId'),
        type: "GET",
        async: false,
        beforeSend: function (xhr) {
            xhr.setRequestHeader('Authorization', 'Bearer ' + getToken()
            ).setRequestHeader('Content-Type', 'application/json')
        },
        success: function (data) {
            console.log(data)
            // START



            var dom = document.getElementById('container');
            var myChart = echarts.init(dom, null, {
                renderer: 'canvas',
                useDirtyRect: false
            });
            var app = {};

            
            try {
                var label1 = data.fields.s2_id.data;
            } catch (error) {
                var label1 = "Count"
            }
            try {
                var label2 = data.fields.s3_id.data;
            } catch (error) {
                var label2 = "Count"
            }
            try {
                var stacked = data.fields.s4_id.data;
                if(stacked == "false"){
                var stacked = false }
                else{
                    var stacked1 = "TOTAL" 
                    var stacked2 = "TOTAL1" 
                }

            } catch (error) {
                var stacked1 = "TOTAL" 
                var stacked2 = "TOTAL1" 
            }

            var option;
            var colorPalette = ['red', 'green', 'orange', "royalblue"]
            // prettier-ignore
            var timeData = data.fields.s1_id.data;
            var obj = []
            var titles = []
            var massimo1 = 0
            var massimo2 = 0

            for (var i = 0; i < data.fields.m1_id.length; ++i) {                
                obj.push({name: data.fields.m1_id[i].name, type: 'line', symbolSize: 8, stack: stacked1, areaStyle: {opacity:0.35}, smooth: true, data: data.fields.m1_id[i].rawData}); 
                titles.push(data.fields.m1_id[i].name)
            }

            for (var i = 0; i < data.fields.m1_id.length; ++i) {                
                var valore_maximo = Math.max(...data.fields.m1_id[i].rawData)
                if (valore_maximo>massimo1){
                    massimo1 = valore_maximo
                }
            }
            
            for (var i = 0; i < data.fields.m2_id.length; ++i) {                
                obj.push({name: data.fields.m2_id[i].name, type: 'line', symbolSize: 8, xAxisIndex: 1, stack: stacked2, yAxisIndex: 1, areaStyle: {opacity:0.35}, smooth: true, data: data.fields.m2_id[i].rawData}); 
                titles.push(data.fields.m2_id[i].name)
            }

            for (var i = 0; i < data.fields.m2_id.length; ++i) {                
                var valore_maximo = Math.max(...data.fields.m2_id[i].rawData)
                if (valore_maximo>massimo2){
                    massimo2 = valore_maximo
                }
            }          
            console.log(obj)

            timeData = timeData.map(function (str) {
                return str.replace('2022/', '');
            });


    option = {
      color: colorPalette,
    tooltip: {
        trigger: 'axis',
        axisPointer: {
        animation: false
        }
    },
    legend: {
        data: titles,
        left: "center"
    },
    axisPointer: {
        link: [
        {
            xAxisIndex: 'all'
        }
        ]
    },
    dataZoom: [
    {
      show: false,
      bottom: 7,
      height: 10,
      realtime: true,
      start: 20,
      end: 100,
      xAxisIndex: [0, 1]
    },
        {
        type: 'inside',
        realtime: true,
        start: 30,
        end: 70,
        xAxisIndex: [0, 1]
        }
    ],
    grid: [
        {
        left: 60,
        right: 50,
        bottom: '50%',
        height: '40%'
        },
        {
        left: 60,
        right: 50,
        top: '50%',
        height: '40%'
        }
    ],
    xAxis: [
        {
        type: 'category',
        boundaryGap: false,
        axisLine: { onZero: true },
        data: timeData
        },
        {
        gridIndex: 1,
        type: 'category',
        show: false,
        boundaryGap: false,
        axisLine: { onZero: true },
        data: timeData,
        position: 'top'
        }
    ],
    yAxis: [
        {
        name: label1,
        type: 'value',
        max: massimo1 + 1/5 * massimo1
        },
        {
        gridIndex: 1,
        name: label2,
        type: 'value',
        inverse: true,
        max: massimo2 + 1/5 * massimo2
        }
    ],
    series: obj
    };

            if (option && typeof option === 'object') {
                myChart.setOption(option);
            }





            // END
            // Your echart graph

        }
    });
</script>

<!-- End Ajax -->

</html>