<!DOCTYPE html>
<html style="height: 100%">
<!-- Start Custom  Style -->

<!-- End Custom style -->

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script
        src='//production-assets.codepen.io/assets/editor/live/console_runner-079c09a0e3b9ff743e39ee2d5637b9216b3545af0de366d4b9aad9dc87e26bfd.js'></script>
    <script
        src='//production-assets.codepen.io/assets/editor/live/events_runner-73716630c22bbc8cff4bd0f07b135f00a0bdc5d14629260c3ec49e5606f98fdd.js'></script>
    <script
        src='//production-assets.codepen.io/assets/editor/live/css_live_reload_init-2c0dc5167d60a5af3ee189d570b1835129687ea2a61bee3513dee3a50c115a77.js'></script>
    <meta charset='UTF-8'>
    <meta name="robots" content="noindex">
    <link rel="shortcut icon" type="image/x-icon"
        href="//production-assets.codepen.io/assets/favicon/favicon-8ea04875e70c4b0bb41da869e81236e54394d63638a1ef12fa558a4a835f1164.ico" />
    <link rel="mask-icon" type=""
        href="//production-assets.codepen.io/assets/favicon/logo-pin-f2d2b6d2c61838f7e76325261b7195c27224080bc099486ddd6dccb469b8e8e6.svg"
        color="#111" />
    <link rel="canonical" href="https://codepen.io/supah/pen/WwrJpw?limit=all&page=86&q=box" />
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css'>
    <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Open+Sans'>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <script src="/lib/scripts/utils.js"></script>
    <script src="/lib/scripts/env.js"></script>
    <script src='https://code.jquery.com/jquery-3.2.1.slim.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js'></script>
    <script src="/lib/scripts/jquery.min.js"></script>
    <link href="/lib/styles/css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="/lib/styles/style.css">
    <script src="https://unpkg.com/mustache@latest"></script>
</head>

</head>
<!-- Start body -->

<body style="height: 100%; margin: 0">
    <div id="container" style="height: 100%"></div>
</body>

<!-- End body -->

<!-- Start Ajax -->
<script type="text/javascript">


    //environment_widget = "https://api-dev.askdata.com";
    //environment_widget = "https://api.askdata.com"  // prod  da togliere quando porto su...


    $.ajax({

        url: environment_widget + "/smartinsight/widgets/" + getUrlParameter('widgetId'),
        type: "GET",
        async: false,
        beforeSend: function (xhr) {
            xhr.setRequestHeader('Authorization', 'Bearer ' + getToken()
            ).setRequestHeader('Content-Type', 'application/json')
        },
        success: function (data) {
            console.log(data)
            // START
            // Your echart graph
            var dom = document.getElementById('container');
            var myChart = echarts.init(dom, null, {
                renderer: 'canvas',
                useDirtyRect: false
            });
            var app = {};

            var option;

            function identify_label(value) {
                labels = ['€', '$', '£', '%'];
                for (let i = 0; i < labels.length; i++) {
                    if (value.indexOf(labels[i]) > -1) {
                        return labels[i];
                    }
                }
                return '';
            }

            m1_data = data.fields.m1_id.data
            var label = identify_label(m1_data[0].toString())
            m1_label = data.fields.m1_id.name
            m2_data = data.fields.m2_id.data
            m2_label = data.fields.m2_id.name


            for(var i = 0; i < m1_data.length; i++)
            {
                m1_data[i] = parseInt(m1_data[i].toString().replace(' %', ''));
                m2_data[i] = parseInt(m2_data[i].toString().replace(' %', ''));
            }




            massimo1 = Math.max(...m1_data);
            massimo2 = Math.max(...m2_data);
            massimo = Math.max(massimo1, massimo2);

            times = data.fields.s1_id.data

            option = {
                tooltip: {
                    trigger: 'axis',
                    valueFormatter: (value) => value + " " + label,
                    axisPointer: {
                        type: 'shadow'
                    }
                },

                dataZoom: [
                    {
                        show: false,
                        realtime: true,
                        start: 65,
                        end: 100
                    },
                    {
                        type: 'inside'
                    }
                ],
                legend: {},
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: [0, 0.01],
                    data: times
                },
                yAxis: {
                    type: 'value',
                    max: massimo
                },
                series: [
                    {
                        name: m1_label,
                        type: 'bar',
                        data: m1_data,
                        label: {
                            show: true,
                            position: 'outside',
                            formatter: function (d) {
                                return d.value + label;
                            }
                        }
                    },
                    {
                        name: m2_label,
                        type: 'bar',
                        data: m2_data,
                        label: {
                            show: true,
                            position: 'outside',
                            formatter: function (d) {
                                return d.value + label;
                            }
                        }
                    }
                ]
            };


            if (option && typeof option === 'object') {
                myChart.setOption(option);
            }

            window.addEventListener('resize', myChart.resize);

            // END
            // Your echart graph

        }
    });
</script>

<!-- End Ajax -->

</html>